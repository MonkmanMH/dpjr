<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Data generation: CR25 • dpjr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Data generation: CR25">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dpjr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/data_list.html">Data list</a></li>
    <li><a class="dropdown-item" href="../articles/data_generate_cr25.html">Data generation: CR25</a></li>
    <li><a class="dropdown-item" href="../articles/data_licenses.html">Data licenses</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/MonkmanMH/dpjr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Data generation: CR25</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MonkmanMH/dpjr/blob/main/vignettes/data_generate_cr25.Rmd" class="external-link"><code>vignettes/data_generate_cr25.Rmd</code></a></small>
      <div class="d-none name"><code>data_generate_cr25.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This set of R chunks creates a synthetic dataset that presents a
variety of data importation and wrangling challenges, as well as some
interesting analytic opportunities.</p>
<p>This is based on my own experience in the late 1980s, to a time when
I was working for a wholesale company that distributed LPs, cassettes,
and those new-fangled compact discs to a wide range of retailers.</p>
<p>The central table in this relational database shows the details of
each store’s orders…but this table needs to be compiled for four
quarterly CSV files.</p>
<p>These can then be linked to other tables about the stores.</p>
</div>
<div class="section level2">
<h2 id="the-scenario">The Scenario<a class="anchor" aria-label="anchor" href="#the-scenario"></a>
</h2>
<p>The fictional wholesale company, CR25 (for “Classic Rock 25”) only
sells 25 album titles. They are the biggest selling / most famous albums
by the 25 most-played artists shown in Walt Hickey’s article “Why
Classic Rock Isn’t What It Used To Be”. <a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Walt Hickey, &lt;a href="https://fivethirtyeight.com/features/why-classic-rock-isnt-what-it-used-to-be/" class="external-link"&gt;Why
Classic Rock Isn’t What It Used To Be&lt;/a&gt; (FiveThirtyEight, 2014-07-07).
The GitHub page with the data for Walt Hickey’s article is available
through &lt;a href="https://github.com/fivethirtyeight/data/tree/master/classic-rock" class="external-link"&gt;GitHub&lt;/a&gt;.&lt;/p&gt;'><sup>1</sup></a></p>
<div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<p>The first step is to install the necessary packages. The seed is set
to <a href="https://www.youtube.com/watch?v=axLRUszuu9I" class="external-link">a number
associated with a classic rock staple</a>, so that future runs of the
code will generate the same data table. This is important, as some of
the examples in the book are based on summary tables drawn from the
master file.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tidyverse packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># utilities</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">8675309</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="input-data">Input data<a class="anchor" aria-label="anchor" href="#input-data"></a>
</h3>
<p>To create the album list, I created a csv file with the artist and
percentage of all plays fields, using the table in the article (which is
displayed as an image; note that there appears to be an error in the
table, in that Boston has a lower rank but a higher percentage than
Queen or Journey). I also added a representative album by that artist—I
used some judgement here. The album is the biggest selling, most famous,
and/or the one with the most hit singles that the artist made. I also
opted for a “no compilations” rule; one could make the case that, as one
example, The Rolling Stones might be better or more accurately
represented by <em>Hot Rocks</em>.</p>
<p>I also added a price field; albums released before 1976 are $7.98, <a href="https://en.wikipedia.org/wiki/Hard_Promises#History" class="external-link">those
released 1976-1981 are $8.98</a>, and 1982 and beyond are $9.98. The
sole exception to this is Pink Floyd’s double album <em>The Wall</em>,
which I priced at $14.98.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">albumlist</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="fu">dpjr</span><span class="fu">::</span><span class="fu"><a href="../reference/dpjr_data.html">dpjr_data</a></span><span class="op">(</span><span class="st">"cr25/cr25_538.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">albumlist</span></span></code></pre></div>
<p>The next step was to create a csv file with some fictional stores.
What I did here was use the names of now-defunct Canadian chains that
were record retailers active in the 70s and 80s. You can find them
listed in the <a href="https://en.wikipedia.org/wiki/List_of_defunct_Canadian_companies#Consumer_retail,_including_grocery" class="external-link">Wikipedia
List of defunct Canadian companies</a> I left off HMV, as it was an
international brand that was late to the market.</p>
<p>I also assigned each store to one of four regions (based on the
cardinal points of the compass), and gave them a store ID number.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">storelist</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="fu">dpjr</span><span class="fu">::</span><span class="fu"><a href="../reference/dpjr_data.html">dpjr_data</a></span><span class="op">(</span><span class="st">"cr25/cr25_storelist.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">storelist</span><span class="op">)</span></span>
<span></span>
<span><span class="va">storelist</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">chain</span>, <span class="va">region</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tally</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">storelist</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">region</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tally</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">storelist</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">chain</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tally</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="create-order">Create order<a class="anchor" aria-label="anchor" href="#create-order"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># order date</span></span>
<span><span class="co"># based on https://cran.r-project.org/web/packages/lubridate/vignettes/lubridate.html</span></span>
<span></span>
<span><span class="va">jan01</span> <span class="op">&lt;-</span> <span class="fu">ymd</span><span class="op">(</span><span class="st">"2019-01-01"</span><span class="op">)</span></span>
<span><span class="va">startdate</span> <span class="op">&lt;-</span> <span class="fu">as_date</span><span class="op">(</span><span class="fu">floor_date</span><span class="op">(</span><span class="va">jan01</span>, <span class="st">"year"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">enddate</span> <span class="op">&lt;-</span> <span class="fu">as_date</span><span class="op">(</span><span class="fu">ceiling_date</span><span class="op">(</span><span class="va">jan01</span>, <span class="st">"year"</span><span class="op">)</span> <span class="op">-</span> <span class="fu">days</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">daterange</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>orderdate <span class="op">=</span> <span class="fu">as_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">startdate</span><span class="op">:</span><span class="va">enddate</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">orderdate_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span> </span>
<span><span class="va">daterange</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">sample_n</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">orderdate</span><span class="op">)</span> </span>
<span><span class="op">}</span>  </span>
<span></span>
<span><span class="co"># set the size of the order based on year quarter</span></span>
<span><span class="co"># - same number of orders but biggest in 4th quarter, smallest in 1st</span></span>
<span><span class="va">order_mean_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">orderdate</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">order_qtr</span> <span class="op">&lt;-</span> <span class="fu">quarter</span><span class="op">(</span><span class="va">orderdate</span><span class="op">)</span></span>
<span>  <span class="va">order_mean</span> <span class="op">&lt;-</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>    <span class="va">order_qtr</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="fl">4</span>,</span>
<span>    <span class="va">order_qtr</span> <span class="op">==</span> <span class="fl">4</span> <span class="op">~</span> <span class="fl">6</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="fl">5</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># function to randomly select the store</span></span>
<span><span class="va">store_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span> </span>
<span><span class="va">storelist</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">sample_n</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">store.id</span><span class="op">)</span> </span>
<span><span class="op">}</span>  </span>
<span></span>
<span></span>
<span><span class="co"># album_order_fun</span></span>
<span></span>
<span><span class="co"># - `rpois` sets the mean value of poisson distribution from which random value is pulled</span></span>
<span></span>
<span><span class="va">album_order_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu">sample_n</span><span class="op">(</span><span class="va">albumlist</span>, <span class="fl">1</span>, weight <span class="op">=</span> <span class="va">pct_plays</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="va">artist</span>, <span class="va">album</span>, <span class="va">price</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lp"</span>, <span class="st">"cass"</span><span class="op">)</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.33</span>, <span class="fl">0.67</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         qty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co"># now with order date and store id appended after the run</span></span>
<span></span>
<span><span class="va">order_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">orderdate</span> <span class="op">&lt;-</span> <span class="fu">orderdate_fun</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># conditional on store open date being before random order date  </span></span>
<span>  <span class="va">orderstore.id</span> <span class="op">&lt;-</span> <span class="fu">store_fun</span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">store.opendate</span> <span class="op">&lt;-</span> <span class="va">storelist</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">store.id</span> <span class="op">==</span> <span class="va">orderstore.id</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">pull</span><span class="op">(</span><span class="va">open_date</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">store.opendate</span> <span class="op">&lt;</span> <span class="va">orderdate</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">order_mean</span> <span class="op">&lt;-</span> <span class="fu">order_mean_fun</span><span class="op">(</span><span class="va">orderdate</span><span class="op">)</span></span>
<span>    <span class="va">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">order_mean</span><span class="op">)</span></span>
<span>  </span>
<span></span>
<span>  <span class="co"># define blank form  </span></span>
<span>  <span class="va">order_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>artist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                          album <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                          price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                          format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                          qty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                          stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>  </span>
<span>  </span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">order_final</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">album_order_fun</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">order_final</span> <span class="op">&lt;-</span> <span class="va">order_final</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>orderdate <span class="op">=</span> <span class="va">orderdate</span>,</span>
<span>           store.id <span class="op">=</span> <span class="va">orderstore.id</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">order_final</span></span>
<span>  </span>
<span>  <span class="co"># end if</span></span>
<span>  <span class="op">}</span></span>
<span><span class="co"># end function</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run one order...</span></span>
<span><span class="fu">order_fun</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Now a run of multiple orders…</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">750</span></span>
<span></span>
<span></span>
<span><span class="va">order_multi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>artist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                          album <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                          price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                          format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                          qty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                          orderdate <span class="op">=</span> <span class="fu">as_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                          store.id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                          stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>  </span>
<span>  </span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">m</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">order_final</span> <span class="op">&lt;-</span> <span class="fu">order_fun</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">order_multi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">order_multi</span>, <span class="va">order_final</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span></span>
<span><span class="co">#write_csv(order_multi, "cr25_order_multi.csv")  </span></span>
<span><span class="co">#write_rds(order_multi, "cr25_order_multi.rds")  </span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">order_multi</span> <span class="op">&lt;-</span> <span class="fu">read_rds</span><span class="op">(</span><span class="fu">dpjr</span><span class="fu">::</span><span class="fu"><a href="../reference/dpjr_data.html">dpjr_data</a></span><span class="op">(</span><span class="st">"cr25/cr25_order_multi.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">order_multi</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="summary-tables">Summary tables<a class="anchor" aria-label="anchor" href="#summary-tables"></a>
</h4>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">order_multi</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">store.id</span>, <span class="va">orderdate</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tally</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">order_multi</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">artist</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>qty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">qty</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">qty</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Build a large scale summary table</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">order_multi</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>order_price <span class="op">=</span> <span class="va">qty</span> <span class="op">*</span> <span class="va">price</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">artist</span>, <span class="va">format</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>qty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">qty</span><span class="op">)</span>,</span>
<span>            cost <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">order_price</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">qty</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">order_multi</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>order_price <span class="op">=</span> <span class="va">qty</span> <span class="op">*</span> <span class="va">price</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">storelist</span>, by <span class="op">=</span> <span class="st">"store.id"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">chain</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>qty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">qty</span><span class="op">)</span>,</span>
<span>            cost <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">order_price</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">qty</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">order_multi</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>order_price <span class="op">=</span> <span class="va">qty</span> <span class="op">*</span> <span class="va">price</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">storelist</span>, by <span class="op">=</span> <span class="st">"store.id"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">region</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>qty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">qty</span><span class="op">)</span>,</span>
<span>            cost <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">order_price</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>pct_of_sales <span class="op">=</span> <span class="va">cost</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">cost</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">qty</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="future-development">Future development<a class="anchor" aria-label="anchor" href="#future-development"></a>
</h2>
<p>It could also be expanded to include additional years (with some
trends embedded), inventory management, and customer relationship
management (CRM).</p>
<p>-30-</p>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Martin Monkman.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
